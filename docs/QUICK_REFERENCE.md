# Quick Reference: Fork/Upstream Management

**For: Workers, Contributors, and Humans**

This is a quick reference for working with the aronchick/multiclaude fork. For detailed guidance, see:
- `docs/FORK_MAINTENANCE_STRATEGY.md` - Full strategy
- `docs/UPSTREAM_WORKFLOW.md` - Detailed workflow
- `docs/UPSTREAM_CONTRIBUTION_PLAN.md` - Contribution status

---

## Branch Naming

| Branch Type | Pattern | When to Use | Example |
|-------------|---------|-------------|---------|
| **Upstream contribution** | `upstream/<name>` | Feature ready for upstream | `upstream/task-history` |
| **Fork-only feature** | `fork/<name>` | Feature that stays in fork | `fork/web-dashboard` |
| **General feature** | `feat/<name>` | Standard feature development | `feat/better-errors` |
| **Bug fix** | `fix/<name>` | Bug fixes | `fix/crash-on-startup` |
| **Worker branch** | `multiclaude/<name>` | Auto-generated by workers | `multiclaude/gentle-fox` |

---

## GitHub Labels

| Label | Meaning | Who Applies |
|-------|---------|-------------|
| üü¢ `upstream-ready` | Ready to contribute upstream | Human (after evaluating merged PR) |
| üü° `upstream-pending` | Upstream PR created | Human (when submitting to upstream) |
| üî¥ `fork-only` | Stays in fork (not upstream) | Human or Worker (for fork features) |
| üî¥ `scope-mismatch` | Violates "one task = one PR" | Merge-queue (automatic) |
| üîµ `scope-override-approved` | Approved scope exception | Human (when justified) |
| üîµ `multiclaude` | Created by worker agent | CLI (automatic) |

---

## Decision Tree: Where Does This Go?

```
Is this feature in ROADMAP.md "Out of Scope"?
‚îú‚îÄ YES ‚Üí Use fork/* branch, label fork-only
‚îî‚îÄ NO ‚Üí Does it improve core functionality?
   ‚îú‚îÄ YES ‚Üí Use feat/* branch, label upstream-ready after merge
   ‚îî‚îÄ UNSURE ‚Üí Use feat/* branch, evaluate after merge
```

---

## Common Workflows

### Creating a Fork-Only Feature

```bash
git checkout -b fork/my-feature main
# ... implement feature ...
gh pr create --base main --label fork-only \
  --title "feat(fork): My fork-only feature"
```

### Creating an Upstream-Ready Feature

```bash
# 1. Create feature in fork
git checkout -b feat/my-feature main
# ... implement feature ...
gh pr create --base main --title "feat: My feature"

# 2. After merge, mark as upstream-ready
gh pr edit <pr-number> --add-label upstream-ready

# 3. Create upstream PR
git checkout -b upstream/my-feature upstream/main
git cherry-pick <relevant-commits>
git push origin upstream/my-feature
gh pr create --repo dlorenc/multiclaude \
  --base main \
  --head aronchick:upstream/my-feature \
  --title "feat: My feature"

# 4. Track upstream PR
gh pr edit <fork-pr-number> --add-label upstream-pending
gh pr comment <fork-pr-number> --body "Upstream PR: <url>"
```

### Handling Scope Mismatch

If merge-queue flags your PR with `scope-mismatch`:

```bash
# Option 1: Split the PR
# Create new branches for each distinct change
git checkout -b feat/change-1 main
git cherry-pick <commits-for-change-1>
gh pr create --base main --title "feat: Change 1"

# Option 2: Get human approval (if justified)
# Comment on PR explaining why scope is necessarily broad
# Ask human to apply scope-override-approved label
```

---

## What Goes Upstream?

### ‚úÖ Upstream Accepts

- Bug fixes
- Performance improvements
- Better error messages
- Agent lifecycle improvements
- Worktree management
- CI/testing improvements
- Documentation
- Core feature enhancements

### ‚ùå Upstream Rejects

- Web interfaces or dashboards
- External integrations (Slack, Discord, etc.)
- Remote/hybrid deployment
- Multi-machine coordination
- Multi-provider support (non-Claude LLMs)
- Enterprise features (SSO, RBAC, etc.)

See `ROADMAP.md` for the complete list.

---

## PR Size Guidelines

| PR Type | Target Size | Flag If | Action |
|---------|-------------|---------|--------|
| Typo/config fix | < 20 lines | > 100 lines | Reject |
| Bug fix | < 100 lines | > 300 lines | Verify single bug |
| Small feature | < 300 lines | > 800 lines | Check scope creep |
| Medium feature | < 800 lines | > 1500 lines | Verify all changes essential |

*Test files excluded from line counts*

---

## Quick Commands

```bash
# Check if we're behind upstream
git fetch upstream
git log --oneline main..upstream/main | head -10

# Check if we're ahead of upstream
git log --oneline upstream/main..main --no-merges | wc -l

# List fork-only features
gh pr list --label fork-only --state merged

# List upstream-ready features
gh pr list --label upstream-ready --state merged

# List pending upstream PRs
gh pr list --label upstream-pending --state merged

# Sync with upstream
git fetch upstream
git checkout main
git merge upstream/main
git push origin main
```

---

## Remember

1. **Upstream First**: Default to contributing upstream unless explicitly fork-only
2. **One Task = One PR**: No exceptions (unless `scope-override-approved`)
3. **Label Everything**: Use labels to track fork vs upstream status
4. **Stay Synced**: Regularly pull from upstream, push improvements back
5. **Focused PRs**: Small, reviewable, self-contained changes

---

## Need Help?

- **Workflow questions**: Read `docs/UPSTREAM_WORKFLOW.md`
- **Strategy questions**: Read `docs/FORK_MAINTENANCE_STRATEGY.md`
- **Contribution status**: Check `docs/UPSTREAM_CONTRIBUTION_PLAN.md`
- **What goes upstream**: Check `ROADMAP.md` (upstream scope)
- **Fork features**: Check `docs/FORK_FEATURES_ROADMAP.md`
